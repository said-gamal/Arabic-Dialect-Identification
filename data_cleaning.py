import re
from maha.cleaners.functions import keep, normalize, remove_tatweel, reduce_repeated_substring # for text cleaning

special_to_arabic = {
    'ٱ': 'ا',
    'ٲ': 'ا',
    'ٶ': 'ؤ',
    'ٸ': 'ئ',
    'ٺ': 'ت',
    'ٻ': 'ي',
    'ټ': 'ت',
    'پ': 'ب',
    'چ': 'ج',
    'ڇ': 'ج',
    'ڈ': 'د',
    'ډ': 'د',
    'ڊ': 'د',
    'ڍ': 'د',
    'ڏ': 'ذ',
    'ڒ': 'ر',
    'ړ': 'ر',
    'ڕ': 'ر',
    'ژ': 'ز',
    'ڛ': 'س',
    'ڜ': 'ش',
    'ڝ': 'ص',
    'ڣ': 'ف',
    'ڤ': 'ف',
    'ڥ': 'ف',
    'ڦ': 'ق',
    'ڨ': 'ف',
    'ک': 'ك',
    'ڪ': 'ك',
    'ڭ': 'ك',
    'گ': 'ك',
    'ڰ': 'ك',
    'ڱ': 'ك',
    'ڲ': 'ك',
    'ڳ': 'ك',
    'ڵ': 'ل',
    'ڷ': 'ل',
    'ڹ': 'ن',
    'ں': 'ن',
    'ڻ': 'ن',
    'ڼ': 'ن',
    'ھ': 'ه',
    'ۀ': 'ه',
    'ہ': 'ه',
    'ۂ': 'ه',
    'ۃ': 'ه',
    'ۄ': 'و',
    'ۅ': 'و',
    'ۆ': 'و',
    'ۇ': 'و',
    'ۈ': 'و',
    'ۉ': 'و',
    'ۋ': 'و',
    'ی': 'ي',
    'ۍ': 'ي',
    'ێ': 'ي',
    'ې': 'ي',
    'ۑ': 'ي',
    '؏': 'ع',
    'ۼ': 'غ',
    'ۿ': 'ه',
    'ݠ': 'ج',
    'ݣ': 'ك',
    'ע': 'لا',
    'פ': 'ح',
    'ﭐ': 'ا',
    'ﭑ': 'ا',
    'ﭙ': 'ب',
    'ﭞ': 'ت',
    'ﭟ': 'ت',
    'ﭠ': 'ت',
    'ﮏ': 'ك',
    'ﮒ': 'ك',
    'ﮓ': 'ك',
    'ﮔ': 'ك',
    'ﮕ': 'ك',
    'ﮧ': 'ه',
    'ﮩ': 'ه',
    'ﮪ': 'ه',
    'ﮫ': 'ه',
    'ﮬ': 'ه',
    'ﮭ': 'ه',
    'ﮯ': 'ه',
    'ﯙ': 'و',
    'ﯛ': 'و',
    'ﯤ': 'ي',
    'ﺀ': 'ء',
    'ﺁ': 'ا',
    'ﺂ': 'ا',
    'ﺃ': 'ا',
    'ﺄ': 'ا',
    'ﺆ': 'ؤ',
    'ﺇ': 'ا',
    'ﺈ': 'ا',
    'ﺉ': 'ئ',
    'ﺊ': 'ئ',
    'ﺋ': 'ئ',
    'ﺌ': 'ئ',
    'ﺍ': 'ا',
    'ﺎ': 'ا',
    'ﺏ': 'ب',
    'ﺐ': 'ب',
    'ﺑ': 'ب',
    'ﺒ': 'ب',
    'ﺓ': 'ة',
    'ﺔ': 'ة',
    'ﺕ': 'ت',
    'ﺖ': 'ت',
    'ﺗ': 'ت',
    'ﺘ': 'ت',
    'ﺚ': 'ث',
    'ﺛ': 'ث',
    'ﺜ': 'ث',
    'ﺝ': 'ج',
    'ﺞ': 'ج',
    'ﺟ': 'ج',
    'ﺠ': 'ج',
    'ﺡ': 'ح',
    'ﺢ': 'ح',
    'ﺣ': 'ح',
    'ﺤ': 'ح',
    'ﺥ': 'خ',
    'ﺦ': 'خ',
    'ﺧ': 'خ',
    'ﺨ': 'خ',
    'ﺩ': 'د',
    'ﺪ': 'د',
    'ﺫ': 'ذ',
    'ﺬ': 'ذ',
    'ﺭ': 'ر',
    'ﺮ': 'ر',
    'ﺯ': 'ز',
    'ﺰ': 'ز',
    'ﺱ': 'س',
    'ﺲ': 'س',
    'ﺳ': 'س',
    'ﺴ': 'س',
    'ﺵ': 'ش',
    'ﺶ': 'ش',
    'ﺷ': 'ش',
    'ﺸ': 'ش',
    'ﺺ': 'ص',
    'ﺻ': 'ص',
    'ﺼ': 'ص',
    'ﺽ': 'ض',
    'ﺾ': 'ض',
    'ﺿ': 'ض',
    'ﻀ': 'ض',
    'ﻁ': 'ط',
    'ﻂ': 'ط',
    'ﻃ': 'ط',
    'ﻄ': 'ط',
    'ﻆ': 'ظ',
    'ﻇ': 'ظ',
    'ﻈ': 'ظ',
    'ﻉ': 'ع',
    'ﻊ': 'ع',
    'ﻋ': 'ع',
    'ﻌ': 'ع',
    'ﻏ': 'غ',
    'ﻐ': 'غ',
    'ﻑ': 'ف',
    'ﻒ': 'ف',
    'ﻓ': 'ف',
    'ﻔ': 'ف',
    'ﻕ': 'ق',
    'ﻖ': 'ق',
    'ﻗ': 'ق',
    'ﻘ': 'ق',
    'ﻙ': 'ك',
    'ﻚ': 'ك',
    'ﻛ': 'ك',
    'ﻜ': 'ك',
    'ﻝ': 'ل',
    'ﻞ': 'ل',
    'ﻟ': 'ل',
    'ﻠ': 'ل',
    'ﻡ': 'م',
    'ﻢ': 'م',
    'ﻣ': 'م',
    'ﻤ': 'م',
    'ﻥ': 'ن',
    'ﻦ': 'ن',
    'ﻧ': 'ن',
    'ﻨ': 'ن',
    'ﻩ': 'ه',
    'ﻪ': 'ه',
    'ﻫ': 'ه',
    'ﻬ': 'ه',
    'ﻭ': 'و',
    'ﻮ': 'و',
    'ﻯ': 'ي',
    'ﻰ': 'ي',
    'ﻱ': 'ي',
    'ﻲ': 'ي',
    'ﻳ': 'ي',
    'ﻴ': 'ي',
    'ﻵ': 'لا',
    'ﻶ': 'لا',
    'ﻷ': 'لا',
    'ﻻ': 'لا',
    'ﻼ': 'لا'
}

# replace non-arabic to arabic chars
chars_table = {ord(char): special_to_arabic[char] for char in special_to_arabic.keys()}

def remove_tashkeel(text):
    tashkeel = re.compile(""" ّ    | # Tashdid
                             َ    | # Fatha
                             ً    | # Tanwin Fath
                             ُ    | # Damma
                             ٌ    | # Tanwin Damm
                             ِ    | # Kasra
                             ٍ    | # Tanwin Kasr
                             ْ    | # Sukun
                              ٓ   | # Madd
                              ٔ   | # Hamza
                              ٕ   | # Hamza
                              ٙ   |
                              ٰ   |
                              ۙ   |
                              ۡ   |
                              ۢ   |
                              ۣ   |
                              ۧ   |
                             ۔   |
                         """, re.VERBOSE)
    text = re.sub(tashkeel, '', text)
    return text

def clean_tweet(tweet):
    for char in ['،', '\n', '؛', '؟', '٫', '٬', '٭', '﴾', '﴿',  '٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩']:
        tweet = tweet.replace(char, ' ')
    tweet = tweet.translate(chars_table)
    tweet = remove_tashkeel(tweet)
    tweet = keep(tweet, arabic=True, arabic_letters=True) # remove any non-arabic text
    tweet = normalize(tweet, all=True) # normalize arabic letters (like: alef, teh-marbouta...)
    tweet = remove_tatweel(tweet) # remove tatweel like ('اهــــــلا') to ('اهلا')
    tweet = reduce_repeated_substring(tweet, min_repeated=4, reduce_to=3) # reduce repeated chars like ('ههههههه') to ('ههه')
    tweet = ' '.join([word for word in tweet.split() if len(word) < 15]) # remove extra spaces and very long words
    return tweet